<template name="clientDetails">
    <div>
        <div class="panel panel-login minWidthElement noBoxShadow">
            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-12">
                        {{#unless Template.subscriptionsReady}}
                            <p style="color:lightgray; margin-top:1em">Loading...</p>
                        {{else}}
                            {{#unless ensureUserExists}}
                                <p>This is not a valid user, please check if there wasn't an error in approaching this page</p>
                            {{else}}
                            <h2> {{client.props.name}} </h2>
                            <br>
                            <div class="row">
                                <div class="col-md-12">
                                    {{#unless userActive}}<p>The user currently has no activated client</p>{{/unless}}
                                    <!--edit user-->
                                    <div class="pull-left">
                                        {{#if successfulUpdate}}
                                            <p style="color:green">successfully updated user </p>
                                        {{/if}}
                                        <button type="button" id="editForm" value="{{client.user_id}}" class="form-control btn btn-login at-btn submit editButton paddedBtn" data-toggle="modal" data-target="#updateFormModal">Update User Profile</button>
                                        <!--Modal form to update the values-->
                                        <div class="modal fade" tabindex="-1" role="dialog" id="updateFormModal">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <form id="updateForm">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                            <h4 class="modal-title">Update Information</h4>
                                                            {{#unless successfulUpdate}}
                                                                <p style="color:red">{{{errorMessage}}}</p>
                                                            {{/unless}}
                                                        </div>

                                                        <div class="modal-body">
                                                            <div class="table-responsive">
                                                                <table class="table table-striped">
                                                                    <tbody>
                                                                    <tr>
                                                                        <th>Client Name</th>
                                                                        <td><input type="text" maxlength="80" id="txtClientNameUpdate" name="clientName" placeholder="Client Name" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>User name</th>
                                                                        <td><input type="text" maxlength="40" id="txtUsernameUpdate" name="username" placeholder="Username" autocapitalize="none" autocorrect="off" disabled="disabled"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>First Name</th>
                                                                        <td><input type="text" maxlength="80" id="txtFirstNameUpdate" name="firstName" placeholder="First Name" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Last Name</th>
                                                                        <td><input type="text" maxlength="80" id="txtLastNameUpdate" name="lastName" placeholder="Last Name" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Company Name</th>
                                                                        <td><input type="text" maxlength="80" id="txtCompanyNameUpdate" name="companyName" placeholder="Company" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Email</th>
                                                                        <td><input type="email" maxlength="40" id="emailUpdate" name="email" placeholder="Email" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Confirm Email</th>
                                                                        <td><input type="email" maxlength="40" id="confirmEmailUpdate" name="confirmEmail" placeholder="Confirm Email" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Password</th>
                                                                        <td><input type="password" maxlength="40" id="passwordUpdate" name="password" placeholder="Password" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Password Repeat</th>
                                                                        <td><input type="password" maxlength="40" id="confirmPasswordUpdate" name="confirmPassword" placeholder="Confirm Password" autocapitalize="none" autocorrect="off"></td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                            <button type="submit" class="btn btn-primary" id="changeAccountSettings">Update</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!--add Message Credit-->
                                    {{#if userActive}}
                                    <div class="pull-right">
                                        {{#if (checkAddMsgCreditsStatus 'idle')}}
                                            <a id="lnkAddMsgCredits" href="#" role="button" class="btn-login btn paddedBtn fullWidth">Add more credits</a>
                                        {{else if (checkAddMsgCreditsStatus 'data-enter')}}
                                            <input id="txiMsgCreditAmount" type="text" placeholder="Credit Amount"/>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <button id="butAddMsgCredits" class="btn-login btn paddedBtn fullWidth topMargin05">Add credit</button>
                                                </div>
                                                <div class="col-md-6">
                                                    <button id="lnkCancelAddMsgCredits" href="#" class="btn-login btn paddedBtn fullWidth topMargin05">Cancel</button>
                                                </div>
                                            </div>
                                        {{else if (checkAddMsgCreditsStatus 'processing')}}
                                            <span style="color:blue">Processing. Please wait...</span>
                                        {{else if (checkAddMsgCreditsStatus 'success')}}
                                            <span>Transaction complete, please wait for Confirmation</span>
                                            <br>
                                            <a id="lnkCancelAddMsgCredits" href="#" role="button" class="btn-login btn paddedBtn">Close</a>
                                        {{else if (checkAddMsgCreditsStatus 'error')}}
                                            <span style="color:red">{{addMsgCreditsError}}</span>
                                              <a id="lnkCancelAddMsgCredits" href="#" role="button" class="btn-login btn paddedBtn">Close</a>
                                        {{/if}}
                                    </div>
                                    {{/if}}
                                </div>
                            </div>
                            <br>


                            <div class="row">
                                <div class="col-lg-12">
                                    <!--<h2> Client Info </h2>-->
                                    <table class="table table-striped">
                                        <tbody>
                                        {{#if userActive}}
                                        <tr>
                                            <td><label>Client&nbsp;ID:&nbsp;</label></td>
                                            <td>{{client.clientId}}</td>
                                        </tr>
                                        <tr>
                                            <td><label>Client&nbsp;Index:&nbsp;</label></td>
                                            <td>{{client.index.clientIndex}}</td>
                                        </tr>
                                        <tr>
                                            <td><label>Username:&nbsp;</label></td>
                                            <td>{{clientUsername client.user_id}}</td>
                                        </tr>
                                        {{/if}}
                                        <tr>
                                            <td><label>Message&nbsp;Credits:&nbsp;</label></td>
                                            <td>
                                                {{messageCredits.confirmed}}{{#if (hasUnconfirmedMessageCredits messageCredits)}}&nbsp;( + unconfirmed: <span style="color:red">{{messageCredits.unconfirmed}}</span>){{/if}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><label> Meteor Account Status:</label></td>
                                            <td>
                                                {{userStatus client.user_id}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><label> User License Type:</label></td>
                                            <td>
                                                {{licenseType client.user_id}} ({{devicesForLicense (licenseType client.user_id)}} devices)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><label> Devices in Use:</label></td>
                                            <td>
                                                {{ numDevices "active"}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><label> Devices Available:</label></td>
                                            <td>
                                                {{ numDevices "available"}}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                            {{#if haveResentEnrollmentEmail}}
                            <div class="pull-left">
                                {{#if resendEnrollmentEmailSuccess}}
                                    <p> Successfully resent enrollment email</p>
                                {{else}}
                                    <!--this pops up first. need to have a "pending" element that shows that it's not an error-->
                                    <p> Wait, sending email. If this line persists, there is an error.</p>
                                {{/if}}
                            </div>
                            {{/if}}
                            <br>
                            <div class="row paddingTop40px">
                                <div class="col-md-3">
                                    <a href="#" id="resendEnrollmentEmail" role="button" class="btn-login btn paddedBtn fullWidth ">Re-Enroll User</a>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" id="updateUserLicense" class="btn-login btn paddedBtn fullWidth " data-toggle="modal" data-target="#changeUserLicense">Change License</button>
                                    <div class="modal fade" tabindex="-1" role="dialog" id="changeUserLicense">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <form id="updateLicenseAdminForm">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                        <h4 class="modal-title">Change User License</h4>
                                                        <p id="currentLicenseStatus"> </p>
                                                        {{#unless successfulLicenseUpdate}}
                                                            <p style="color:red">{{{licenseErrorMessage}}}</p>
                                                        {{/unless}}
                                                    </div>
                                                    <div class="modal-body">
                                                        <label class="radio-inline">
                                                            <input type="radio" name="licenseStateRadio" id="starter" value="Starter" required> Starter: {{devicesForLicense "Starter"}}
                                                            <!--have to finish this work.-->
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="licenseStateRadio" id="basic" value="Basic"> Basic: {{devicesForLicense "Basic"}}
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="licenseStateRadio" id="professional" value="Professional"> Professional: {{devicesForLicense "Professional"}}
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="licenseStateRadio" id="enterprise" value="Enterprise"> Enterprise: {{devicesForLicense "Enterprise"}}
                                                        </label>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                        <button type="submit" class="btn btn-primary" id="licenseChangeSubmit">Change License</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-3">
                                    {{#unless userActive}}
                                        <a href="#" id="activateUser" role="button" class="btn-login btn paddedBtn fullWidth ">Activate User</a>
                                    {{else}}
                                        <a href="#" id="deactivateUser" role="button" class="btn-login btn paddedBtn fullWidth ">Deactivate User</a>
                                    {{/unless}}
                                    <!--also have a slot for incase the user is pending-->
                                </div>
                                <div class="col-md-3">
                                    {{#unless showDevices}}
                                            <a href="#" id="lnkShowDevices" role="button" class="btn-login btn paddedBtn fullWidth ">Show devices</a>
                                    {{else}}
                                            <a id="lnkHideDevices" href="#" role="button" class="btn-login btn paddedBtn fullWidth">Hide devices</a>
                                    {{/unless}}
                                </div>

                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-12">
                                    <div>
                                        {{#if showDevices}}
                                            {{#if client._id}}
                                                {{> devices user_id=user_id}}
                                            {{/if}}
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                            {{/unless}}
                        {{/unless}}
                        <div class="row">
                            <div class="col-md-6">
                                <a href="/admin/clients" role="button" class="btn-login btn paddedBtn fullWidth">Back to Users</a>
                            </div>
                            <div class="col-md-6">
                                <a href="/admin/newclient" role="button" class="btn-login btn paddedBtn fullWidth">Add another User</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
